<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>



    <style>


        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body{ 
			font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: #181818;
            color: #fff;
			user-select: none;
            
        }


        html, body{
            overflow: hidden hidden;
            scroll-behavior: contain;
            touch-action: pan-x pan-y;
            
        }
         
 

        #main_list{
            width: 100%;
            height: 100%;
            background-color: #000; 
        }
        

        .item_wrapper{
            height: 64px;
            background-color: #212121;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px; 
            position: relative;
            top: 0;
            left: 0;
        }

        /* .item_wrapper:first-child{
            background-color: green;
        }
        .item_wrapper:last-child{
            background-color: brown;
        } */
 


        .item_title{
            font-size: 1.2em;
            font-weight: 600;
        }

        .item_subTitle,
        .item_sorter_button{
            color: #9e9e9e;
        }



        .item_sorter_button{
            width: 32px;
            height: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            border-radius: 8px;
        }
        .item_sorter_button svg{
            pointer-events: none;
        }





    </style>


</head>



<body>

    
    






    <div id="main_list">


        <!-- ITEM -->
        <div class="item_wrapper">
            <div class="item_content">
                <div class="item_title">Blame</div>
                <div class="item_subTitle">Calvin Harris</div>
            </div>
            <div class="item_sorter_button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
        </div>


        <!-- ITEM -->
        <div class="item_wrapper">
            <div class="item_content">
                <div class="item_title">Cinema</div>
                <div class="item_subTitle">Skrillex</div>
            </div>
            <div class="item_sorter_button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
        </div>


        <!-- ITEM -->
        <div class="item_wrapper">
            <div class="item_content">
                <div class="item_title">Unity</div>
                <div class="item_subTitle">The Fat Rat</div>
            </div>
            <div class="item_sorter_button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
        </div>


        <!-- ITEM -->
        <div class="item_wrapper">
            <div class="item_content">
                <div class="item_title">Save me</div>
                <div class="item_subTitle">Avenged Sevenfold</div>
            </div>
            <div class="item_sorter_button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
        </div>


    </div>


 


     


    <script>


        var main_list = document.getElementById("main_list");

        var touch_start = {x: 0, y: 0};
        var can_swipe = false;
        var can_sort  = false; 

        var index_old = -1;

        let flag = false;

        main_list.querySelectorAll(".item_wrapper").forEach((e, i) => {


            e.ontouchstart = (evt) => {
                e.style.transition = '';
                e.style.backgroundColor = '#353535';
                touch_start.x = evt.touches[0].clientX - e.offsetLeft;
                touch_start.y = evt.touches[0].clientY - e.offsetTop;
                can_sort = false;
                can_swipe = true;
            };


            e.ontouchend = () => {
                e.style.backgroundColor = '';
                e.style.transition = '200ms';
                e.style.left = 0;
                
                if ( Math.abs(e.offsetLeft) > e.offsetWidth/2 ){
                    e.style.left = ((e.offsetLeft<0)?-1:1) * e.offsetWidth + 'px';
                    e.style.opacity = 0;

                    setTimeout(()=>{
                        e.remove();
                    }, 200);

                }else{
                    e.style.opacity = 1;
                }

            };




            e.ontouchmove = (evt) => {

                let pos = {
                    x: evt.touches[0].clientX - touch_start.x,
                    y: evt.touches[0].clientY - touch_start.y,
                };

                
                e.style.transition = '';


                if ( can_swipe ){ 
                    e.style.left = `${pos.x}px`;
                    e.style.opacity = 1 - (Math.abs(e.offsetLeft)/e.offsetWidth); 
                }



                else if ( can_sort ){
                    e.style.zIndex = '1';
                    e.style.top = `${pos.y}px`;

                    let absoluteY = e.offsetTop;

                    let nextSibling     = e.nextElementSibling;
                    let previusSibling  = e.previousElementSibling;

                    let nextSiblingLength = main_list.children.length - [...main_list.children].indexOf(e)- 1;
                    let previusSiblingLength = [...main_list.children].indexOf(e); 


                    for (let index = previusSiblingLength; index < nextSiblingLength + previusSiblingLength; index++){
                        nextSibling.style.transition = '';
                        nextSibling.style.zIndex = '';
                        if ( e.offsetTop + e.offsetHeight >= nextSibling.offsetTop ){
                            let posY = -(absoluteY -64 * index);
                            nextSibling.style.top = (posY <= -64)? '-64px' : posY + 'px';
                            nextSibling = nextSibling.nextElementSibling; 
                        }else{
                            nextSibling.style.top = '0px'; 
                            break; 
                        }
                    }




                    for (let index = 0; index < previusSiblingLength; index++){
                        previusSibling.style.transition = '';
                        previusSibling.style.zIndex = '';
                        if ( e.offsetTop <= previusSibling.offsetTop + previusSibling.offsetHeight ){
                            let posY = Math.abs(64 * (previusSiblingLength - index) - absoluteY);
                            previusSibling.style.top = (posY >= 64 )? '64px' : posY + 'px';
                            previusSibling = previusSibling.previousElementSibling;
                        }
                        else{
                            previusSibling.style.top = '0px'; 
                            break;
                        }
                    }
                    


                }


            };





            e.onclick = () => {
                console.log('item click');
            };




            e.querySelector('.item_sorter_button').ontouchstart = (evt) => {
                evt.stopImmediatePropagation();
                evt.target.style.backgroundColor = '#353535';
                touch_start.y = evt.touches[0].clientY;
                e.classList.add('item_sorter_active'); 
                can_swipe = false;
                can_sort = true;
            };


            e.querySelector('.item_sorter_button').ontouchend = (evt) => {
                evt.stopImmediatePropagation();
                evt.target.style.backgroundColor = '';

                let index_sorted = [...main_list.children].indexOf(e);
                let to_index = 0;
                
                to_index = Math.trunc(e.offsetTop/(e.offsetHeight/2 + e.offsetHeight/4));

                if ( to_index >= main_list.children.length ){
                    to_index = main_list.children.length - 1;
                }
                else if ( to_index < 0 ){
                    to_index = 0;
                }
                



                console.log('release', index_sorted, to_index );


                main_list.children[to_index].style.transition = e.style.transition = '200ms';

                 

                 
                 
                
                  

                
                e.style.top = (64 * (to_index - index_sorted)) + 'px';
                



                setTimeout(()=>{ 
                    

                    main_list.querySelectorAll(".item_wrapper").forEach(el => {
                        el.style.transition = '';
                        el.style.top = '0px';
                    });

                    
                    if ( index_sorted < to_index ){
                        to_index++;
                    }

                    main_list.insertBefore(e, main_list.children[to_index]);
                    
                }, 200);

                


                
                


                e.classList.remove('item_sorter_active');



            };

            e.querySelector('.item_sorter_button').onclick = (evt) => {
                evt.stopImmediatePropagation(); 
            };


        });
         

        


    </script>


</body>
</html>